<div id="content" class="container"></div>
<script>
    window.onload = async () => {
        if (window.opener) {
            const params = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = params.get('access_token') || window.localStorage.getItem('access_token');
            const tokenType = params.get('token_type') || window.localStorage.getItem('token_type');
            history.replaceState({}, '', window.location.origin + window.location.pathname);
            window.localStorage.setItem('access_token', accessToken);
            window.localStorage.setItem('token_type', tokenType);
            if (accessToken === 'null') return (document.getElementById('login').style.display = 'block');
            const user = await (await fetch('https://discord.com/api/users/@me', { headers: { authorization: `${tokenType} ${accessToken}` } })).json();
            params.delete('access_token');
            window.opener.postMessage('reloadDash');
            window.close();
        } else {
            setTimeout(() => console.log(window.user), 200);
        }
    };
    window.addEventListener('message', (event) => {
        if (event.origin !== location.origin) return;
        if (event.data === 'reload') location.reload();
        if (event.data === 'reloadDash') location.replace(location.origin + '/dashboard/');
    });
</script>
